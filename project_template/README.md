# Modern C++ Development setup with VSCode, CMake, vcpkg and clangd

## Requirements

- VSCode
- Compiler: [WinLibs](https://winlibs.com/) with LLVM (already including cmake, clang-format, clang-tidy, cppcheck and ninja)
- Git for Windows
- VSCode extensions:
  - CMake Tools
  - clangd

## Project Structure

```
project_root\
├── .clang-format
├── .gitignore
├── CMakeLists.txt
├── CMakePresets.json
├── README.md
├── vcpkg.json
│
├── .vscode\
│   └── settings.json
├── build\  (generated by CMake)
├── out\    (generated by CMake)
├── cmake\
│   ├── ClangFormat.cmake
│   ├── CppCheck.cmake
│   └── ...
├── doc\
├── src\
├── examples\
└── tests\
```

## Configure and build with CMake presets

https://github.com/microsoft/vscode-cmake-tools/blob/main/docs/cmake-presets.md

Starting with CMake 3.19 (released November 2020) a new feature called CMake Presets has been added to describe CMake configuration options in a universal way. This makes it easier to maintain consistent build configurations across different developer setups and CI/CD pipelines.

### CMake Presets Definition File

CMake Presets contain information how to configure, build, test and even package a project. Preset information is stored in a JSON files:

```json
{
  "version": 6,
  "cmakeMinimumRequired": {
    "major": 3,
    "minor": 23,
    "patch": 0
  },
  "configurePresets": [
    {
      // ...
    }
  ],
  "buildPresets": [
    {
      // ...
    }
  ],
  "testPresets": [
    {
      // ...
    }
  ]
}
```

With the `configurePresets` I specify how the project is configured (paths, architecture, options, …). They are used if I do a `CMake: Configure` in VS Code.

The `buildPresets` describe what build types I have (e.g. debug, release, …). And finally, the `testPresets` define the builds to be used for testing. They are used if I do a `CMake: Build` in VS Code.

The default file is named `CMakePresets.json` and is located in the root folder of the project:

### Configure Presets

To configure cmake with a preset run:
```
cmake --preset <preset_name>
cmake --preset gcc-debug
```

### Build Presets

To build a preset run:
```
cmake --build build/<preset_name>
cmake --build build/gcc-debug
```

## vcpkg

Clone the vcpkg repository from GitHub. The repository contains scripts to acquire the vcpkg executable and a registry of curated open-source libraries maintained by the vcpkg community.
```
cd E:\Dev\Tools
git clone https://github.com/microsoft/vcpkg.git
```

Run the bootstrap script:
```
cd vcpkg
.\bootstrap-vcpkg.bat
```
The bootstrap script performs prerequisite checks and downloads the vcpkg executable.

That's it! vcpkg is set up and ready to use.

Create the environment variable `VCPKG_ROOT` to tell vcpkg where your vcpkg instance is located.

Create a manifest file `vcpkg.json` in the project folder root:
```json
{
    "dependencies": [
        "fmt"
    ]
}
```

Add this to `CMakePresets.json` configurePreset:
```json
      "cacheVariables": {
        "CMAKE_TOOLCHAIN_FILE": "$env{VCPKG_ROOT}/scripts/buildsystems/vcpkg.cmake"
      }
```
This tells CMake to automatically link libraries installed by vcpkg using vcpkg's custom toolchain.

Use package in project:
```
find_package(fmt CONFIG REQUIRED)
```

## clangd

## VSCode Specific Settings

See `.vscode\settings.json`
